---
title: ""
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
library(readr)
sklep_rowerowy <- read_csv("sklep_rowerowy.csv")
```

#Pakiet NANIAR do analizowania braków danych

```{r}
# install.packages("naniar")
library(naniar)
```

# Zliczanie całkowitej liczby NA

```{r}
n_miss(sklep_rowerowy)
```

# Zliczanie całkowitej liczby kompletnych wartości

```{r}
n_complete(sklep_rowerowy)
```

# Procent braków

```{r}
prop_miss(sklep_rowerowy)
```

# Tabela podsumowująca NA
#to nie do wnioskowania, brakow danych nie wnioskujemy

```{r}
miss_var_summary(sklep_rowerowy)
```

# Wizualizacja NA

#obserwacje pokazuja wiersze w jakich sa braki

```{r}
vis_miss(sklep_rowerowy)
```

#Wizualizacja ogólnej liczby NA #gdyby wg płci się zrobiła zaleznośc, to
bylyby braki na zolto, a tutaj nie ma #u nas nie bedzie za duzo widac,
poniewaz mamy bardzo malo brakow

```{r}
cluster = TRUE
sort_miss = TRUE 
gg_miss_fct(sklep_rowerowy, Gender)
```

# Przekroje NA

```{r}
gg_miss_upset(sklep_rowerowy,
              nsets=53)
```

#brakuje wypelniania brakow- najpierw powinnismy sprawdzic czy sa bledy,
jak nie ma, to wypelniamy braki, czyli kolejnosc jest u nas dobra

# Instalujemy pakiety

```{r include=FALSE}
#if(!require("tidyverse")) install.packages("tidyverse")
#if(!require("dlookr")) install.packages("dlookr")
#if(!require("editrules")) install.packages("editrules") #reguły 
#if(!require("VIM")) install.packages("VIM")
#if(!require("validate")) install.packages("validate")

library(tidyverse)
library(dlookr)
library(editrules) #reguły
library(VIM)
library(validate)
```

#Reguły: dodac kilka regul tutaj #reguly do wszystkich numerycznych
zmiennych dac

```{r}
reguly <- editset(c( 
  "Age>=1",
  "Age<=120",
  "Income>=0",
  "Children>=0",
  "Children<=5",
  "Cars>=0",
  "Cars<=10", 
  "Children>=0",
  "Children<=5"
  ))
```

#np jesli jestes dzieckiem, to masz rower, masz ppnizej 3 lat, nie posiadasz roweru
#jesli masz srednie dochody to prawd jestes posiadaczem roweru- wnioskowanie dla populacji np kraju, np mamy 40 mezczyzn i 30 z nich ma rower, to 70% ogolem jest posiadaczem roweru

#reguły dodane Edyta

#dla tesktowych rowniez, ale inna formula
#dodane Edyta - stan cywilny i posiadacz domu 
```{r}
library(validate)
wynik_reguly<-check_that(sklep_rowerowy,Marital.status==Married,Income>=70000)
wynik_reguly
wynik_reguly2<-check_that(sklep_rowerowy,Gender==Male, Home.Owner==Yes)
wynik_reguly2
```
# dane z edukacja, posiadaniem roweru, poziomem wyksztalcenia i zawodem

```{r}
library(validate)
wynik_reguly<-check_that(sklep_rowerowy,Region==Pacific,Purchased_Bike==Yes)
wynik_reguly
wynik_reguly2<-check_that(sklep_rowerowy,Education==Bachelors,Occupation==Professional)
wynik_reguly2
```
# dane jako kobieta, edukacja, nie posiada domu, singiel
```{r}
library(validate)
wynik_reguly<-check_that(sklep_rowerowy,Gender==Female,Education==Graduate_Degree)
wynik_reguly
wynik_reguly2<-check_that(sklep_rowerowy,Home_Owner==No,Marital.status==Single)
wynik_reguly2
```

#Poprawiam błędy w danych #nie bylo zadnych bledow wiec nic nie poprawil
```{r}
sklep_rowerowy[localizeErrors(reguly,sklep_rowerowy)$adapt] <- NA
```

## Wypełnianie braków danych

#Ze względu na bardzo małą liczbę braków danych, imputacje można wykonać
#za pomocą średniej/ mediany albo metodą hot deck- wkleic kilka slow jaka to metoda
#srednia- dla danych bardziej zroznicowanych

```{r}

#install.packages("hot.deck")
#install.packages("VIM")
library(VIM)
library(hot.deck)

sklep_rowerowy <- hotdeck(sklep_rowerowy)
sum(is.na(sklep_rowerowy))
```

#ta metoda probuje znalezc podobny wiersz, w ktorym mamy brak, przydatne
#przy masowych brakach ta druga funkcja pokazuje czy sa jeszcze jakies
#braki nowy rozdzial dla wizualizacji danych, to bedzie na zajeciach
#pokrywane- kto kupil rower, kim jest ta osoba, czy ma wyksztalcenie/
#dzieci, roznice i to w wykresach dodac pare slow komentarzy..

#Wizualizacja danych

co rysować??

czy kupił czy nie kupił rower 

i kim jesteś jak kupujesz, a kim jesteś jak nie kupujesz

jakie masz dochody, ile masz km do pracy, wyksztalcenie, plec 

ciekawe przyklady 

posiadanie domu vs wiek 
liczba dzieci vs wiek 
czy ma rower vs odleglosc 
pensja vs wyksztalcenie mam
wplywy vs 
rower vs wiek 
rower vs region 
pensja vs rower 
rower vs odleglosc

#wyogolnic we wnioskowaniu, np ze osoby zonate czesciej kupuja rower albo jaki wiek
#jakby dane byly na srodku- to wiemy, ze nasze dane pochodza z rozkladu norm
#na lewo pochodza z rozkladu prawo-skosnego, a na prawo, to z rozkladu lewo-skosnego
#pudelko- lewa to 1szy kwartyl, po prawej 3 kwartyl/ srodkowa kreska to chyba mediana/ srednia- do spr na necie
#kropki- obserwacje odstajace tzw outsiders- wygolnic, ze 80-90 latek rzadko jest wlascicielem roweru
# dom vs wiek
```{r}
library(ggplot2)
library(hrbrthemes)
library(plotly)
library(ISLR)
library(tidyselect)
library(readxl)
library(janitor)
sklep_rowerowy <- janitor::clean_names(sklep_rowerowy)

ggplot(sklep_rowerowy, aes(x=home_owner, y=age)) +
 geom_boxplot() +
 coord_flip()

```
# Zależność wieku i zarobków:
#jak najwiecej informacji o tych rowerow
```{r}
ggplot(sklep_rowerowy, aes(x=income,
 y=age)) +
 geom_point() +
 xlab("zarobek") +
 ylab("wiek")
ggtitle("Zarobki w porównaniu do wieku")
```

# liczba dzieci vs wiek 
```{r}
ggplot(sklep_rowerowy, aes(x=children,
 y=age)) +
 geom_point() +
 xlab("liczba dzieci") +
 ylab("wiek")
ggtitle("Dzieci vs wiek")

```
#posiadanie domu w porównaniu do wieku

```{r}
ggplot(sklep_rowerowy, aes(x=age,
 y=home_owner)) +
 geom_boxplot() +
 xlab("wiek") +
 ylab("czy posiada dom")
ggtitle("Posiadanie domu w porównaniu do wieku")

```
#Zarobki vs poziom edukacji
```{r}
ggplot(sklep_rowerowy, aes(x=income,
 y=education)) +
 geom_boxplot() +
 xlab("zarobki") +
 ylab("poziom edukacji")
ggtitle("zależność zarobków od poziomu edukacji")

```
# rower vs pensja
```{r}
ggplot(sklep_rowerowy, aes(x=income,
 y=purchased_bike)) +
 geom_boxplot() +
 xlab("zarobki") +
 ylab("liczba rowerów")
ggtitle("zależność zarobków do posiadania rowerów")

```
#dodane Julia

#Wykres gęstości zarobków- widac, ze nie jest to rozkład normalny- test Shapiro-wilka do normalnego rozkladu
#p-value spr
#zastanowic sie czy ponizsze jest potrzebne
#spr jaki test statystyczny tu zrobic- z jakiego rozkladu pochodza te dane i takim testem sprawdzone

```{r}
ggplot(sklep_rowerowy, aes(x = income)) +
  geom_density(alpha = 0.7, fill = "blue", color = "black") +
  xlab("Zarobek") +
  ylab("Gęstość") +
  ggtitle("Rozkład zarobków") +
  theme_minimal()
```


# Grupowanie i zliczanie
```{r}
library(dplyr)

dane_zliczone <- sklep_rowerowy %>%
  group_by(region, purchased_bike) %>%
  summarise(liczba = n())
```

#region vs liczba rowerów- takie wykresy porobic
```{r}
library(ggplot2)

ggplot(dane_zliczone, aes(x = region, y = liczba, fill = purchased_bike)) +
  geom_bar(stat = "identity", position = "dodge") +
  xlab("Region") +
  ylab("Liczba osób") +
  ggtitle("Liczba osób posiadających rowery w zależności od regionu") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red"), name = "Posiadanie roweru")
```


# Grupowanie według wieku i posiadania roweru, a następnie zliczanie
```{r}
library(dplyr)

dane_wiek <- sklep_rowerowy %>%
  group_by(age, purchased_bike) %>%
  summarise(liczba = n(), .groups = "drop")
```

#wiek vs liczba rowerów
```{r}
library(ggplot2)

ggplot(dane_wiek, aes(x = age, y = liczba, fill = purchased_bike)) +
  geom_bar(stat = "identity", position = "dodge") +
  xlab("Wiek") +
  ylab("Liczba osób") +
  ggtitle("Liczba osób posiadających rowery w zależności od wieku") +
  scale_fill_manual(values = c("Yes" = "green", "No" = "purple"), name = "Posiadanie roweru")
```


# Grupowanie i zliczanie według odległości dojazdu i posiadania roweru
```{r}
library(dplyr)

dane_dojazd <- sklep_rowerowy %>%
  group_by(commute_distance, purchased_bike) %>%
  summarise(liczba = n(), .groups = "drop")
```

# rower vs odległość dojazdu do pracy
```{r}
library(ggplot2)
library(forcats)

ggplot(dane_dojazd, aes(x = factor(commute_distance, levels = sort(unique(commute_distance))), 
                        y = liczba, fill = purchased_bike)) +
  geom_bar(stat = "identity", position = "stack") +
  xlab("Odległość dojazdu do pracy") +
  ylab("Liczba osób") +
  ggtitle("Liczba osób posiadających rowery w zależności od odległości dojazdu do pracy") +
  scale_fill_manual(values = c("Yes" = "yellow", "No" = "orange"), name = "Posiadanie roweru") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Obrót etykiet dla lepszej czytelności
```


#ilość osób zamęznych vs wiek
```{r}
library(ggplot2)
library(hrbrthemes)
library(plotly)
library(ISLR) # for Credit data
data("Credit")

# Podziel zmienną Age na 3 przedziały wiekowe:
Credit$AgeGroup <- cut(Credit$Age, breaks=c(20,40,60,100),
                       labels=c("20-40", "40-60", "60-100"))

ggplot(Credit, aes(x=AgeGroup, fill=Married)) + 
  geom_bar(position="stack") +
  labs(title="Liczba osób zamężnych w zależności od grupy wiekowej", x="Grupa wiekowa", y="Liczba osób") +
  theme_classic()
```


#wnioskowanie statystyczne- wyciągniecie wniosków na temat wszystkich posiadaczy rowerów
#pod kazdym wykresem wnioski dla wykresu i uogolnienie dla populacji- spr tez enauczanie
#mozna zmieniac czcionki jak w wordzie/ mozna popatrzec na dostepne funkcje
#spr markdown na enauczaniu jak sie chunki wordowe dodaje
#wykres w zaleznosci od ilosci dzieci
#zrobic te wykresy dla kazdej danej- czy ma rower czy nie, lepiej wiecej niz mniej- pododawac

