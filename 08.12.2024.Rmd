---
title: ""
date: "`r Sys.Date()`"
author: "Edyta Adamska, Julia Bakalarz, Paulina Kotlewska"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
editor_options: 
  markdown: 
    wrap: 72
---
## Wprowadzenie 
ssssssss

Naszym pierwszym krokiem bla bla 

## Ładowanie danych 

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
library(readr)
sklep_rowerowy <- read_csv("sklep_rowerowy.csv")
```

# Ładowanie pakietów 

```{r include=FALSE}
#if(!require("tidyverse")) install.packages("tidyverse")
#if(!require("dlookr")) install.packages("dlookr")
#if(!require("editrules")) install.packages("editrules") #reguły 
#if(!require("VIM")) install.packages("VIM")
#if(!require("validate")) install.packages("validate")
library(ggplot2)
library(hrbrthemes)
library(plotly)
library(ISLR)
library(tidyselect)
library(readxl)
library(janitor)
sklep_rowerowy <- janitor::clean_names(sklep_rowerowy)

library(tidyverse)
library(dlookr)
library(editrules) #reguły
library(VIM)
library(validate)
```

# Sprawdzenie struktury danych 

```{r}
str(sklep_rowerowy)
```

#Analiza braków danych 
Wykorzystując pakiet "naniar" ustalamy czy w wśród naszych danych znajdują się braki danych. 

#Instalacja pakietu 

```{r}
# install.packages("naniar")
library(naniar)
```

# Zliczanie całkowitej liczby braków

```{r}
n_miss(sklep_rowerowy)
```
#Są 53 braki w zbiorze danych.

# Zliczanie całkowitej liczby kompletnych wartości

```{r}
n_complete(sklep_rowerowy)
```
#Liczba całkowitych wartości - bez brakujących wartości to 12947. 

# Procent braków

```{r}
prop_miss(sklep_rowerowy)
```
#Wśród zbioru danych brakujące wartości to około 0,41% odnośnie do liczby wszystkich wartości. 

# Tabela podsumowująca braki w zbiorze danych 

```{r}
miss_var_summary(sklep_rowerowy)
```
#Największa ilosć braków znajduje się w kolumnie "Gender". Braki znajdują się w 7 kolumnach z 12.

# Wizualizacja braków

```{r}
vis_miss(sklep_rowerowy)
```

#Wizualizacja ogólnej liczby braków
```{r}
gg_miss_fct(sklep_rowerowy, fct = Gender) +
  scale_fill_distiller(direction = 1, palette = "PiYG")
gg_miss_fct(sklep_rowerowy, fct = Cars) +
  scale_fill_distiller(direction = 1, palette = "PiYG")
gg_miss_fct(sklep_rowerowy, fct = Children) +
  scale_fill_distiller(direction = 1, palette = "PiYG")
gg_miss_fct(sklep_rowerowy, fct = `Home Owner`) +
  scale_fill_distiller(direction = 1, palette = "PiYG")
gg_miss_fct(sklep_rowerowy, fct = Income) +
  scale_fill_distiller(direction = 1, palette = "PiYG")
gg_miss_fct(sklep_rowerowy, fct = `Marital Status`) +
  scale_fill_distiller(direction = 1, palette = "PiYG")
gg_miss_fct(sklep_rowerowy, fct = Age) +
  scale_fill_distiller(direction = 1, palette = "PiYG")

```
DO POPRAWY ALE JESZCZE NIE WIEM JAK 

# Przekroje braków

```{r}
gg_miss_upset(sklep_rowerowy,
              nsets=53)
```
#Tu nie wiem jaki wniosek help Julka 

#tu też 
#Reguły: dodac kilka regul tutaj #reguly do wszystkich numerycznych
zmiennych dac

```{r}
reguły <- editset(c( 
  "Age>=1",
  "Age<=120",
  "Income>=0",
  "Children>=0",
  "Children<=5",
  "Cars>=0",
  "Cars<=10", 
  "Children>=0",
  "Children<=5"
  ))
```
**** Nie wiem czy to zostawiamy czy co

#Walidacja danych 
#Za pomocą walidacji danych sprawdzamy czy spełnione zostały nasze założenia  

#Instalowanie pakietu "validate" 
```{r}
library(validate)
```

# Sprawdzenie wartości jakie są w zbiorze danych 
```{r}
glimpse(sklep_rowerowy)
```

```{r}
reguly <- validator(
  Gender %in% c("Male", "Female"),
  `Marital Status` %in% c("Married", "Single"),
  Income >= 0,
  Education %in% c("Bachelors", "Partial College", "High School", "Gradute Degree","Partial High School"),
  Occupation %in% c("Skilled Manual","Clerical", "Professional","Management", "Manual"),
  Children >= 0,
  Cars >= 0,
  Age > 0,
  `Home Owner` %in% c("Yes", "No"),
  `Purchased Bike` %in% c("Yes", "No"),
  Region %in% c("Europe", "Pacific", "North America"),
  `Commute Distance` %in% c("0-1 Miles", "1-2 Miles", "10+ Miles", "2-5 Miles", "5-10 Miles")
)
```
```{r}
results <- confront(sklep_rowerowy,reguly)
summary(results)
```

* nie wiem czy robic tak jak mowilam czy zostawic to zaznaczam gwiazkdami ***

```{r}
library(validate)
wynik_reguly<-check_that(sklep_rowerowy,Marital.status==Married,Income>=70000)
wynik_reguly
wynik_reguly2<-check_that(sklep_rowerowy,Gender==Male, Home.Owner==Yes)
wynik_reguly2
```
# dane z edukacja, posiadaniem roweru, poziomem wyksztalcenia i zawodem

```{r}
library(validate)
wynik_reguly<-check_that(sklep_rowerowy,Region==Pacific,Purchased_Bike==Yes)
wynik_reguly
wynik_reguly2<-check_that(sklep_rowerowy,Education==Bachelors,Occupation==Professional)
wynik_reguly2
```
# dane jako kobieta, edukacja, nie posiada domu, singiel
```{r}
library(validate)
wynik_reguly<-check_that(sklep_rowerowy,Gender==Female,Education==Graduate_Degree)
wynik_reguly
wynik_reguly2<-check_that(sklep_rowerowy,Home_Owner==No,Marital.status==Single)
wynik_reguly2
```

#Poprawiam błędy w danych #nie bylo zadnych bledow wiec nic nie poprawil
```{r}
sklep_rowerowy[localizeErrors(reguly,sklep_rowerowy)$adapt] <- NA
```
****
## Wypełnianie braków danych
#Instalowane potrzebnego pakietu

```{r}
#install.packages("hot.deck")
#install.packages("VIM")
library(VIM)
library(hot.deck)
```

#Imputacja

```{r}
sklep_rowerowy_imp <- hotdeck(sklep_rowerowy)
print(sklep_rowerowy_imp)
sum(is.na(sklep_rowerowy_imp))
```


#Ze względu na bardzo małą liczbę braków danych zdecydowałyśmy się na imputacje metodą hot deck. Polega na zastępowaniu brakujących wartości (NA) rzeczywistymi wartościami pobranymi z podobnych obserwacji w tym samym zbiorze danych.
#SPRAWDZIĆ CZY NA PEWNO DOBRZE

## Wizualizacja danych 

#Zależność wieku i zarobków

```{r}
ggplot(sklep_rowerowy, aes(x=income,
 y=age)) +
 geom_point() +
 xlab("Zarobek") +
 ylab("Wiek")
ggtitle("Zarobki w porównaniu do wieku")
```
#Wniosek: Na podstawie wykresu można wywnioskować, że zarobek nie rośnie jednoznacznie z wiekiem. Dodatkowo osoby w podobnym wieku mają bardzo różne zarobki, choćby w przedziale 40 - 60 lat.Wszystko to może być zależne od branży czy wykształcenia badanej grupy osób. Większość zarobków znajduje się poniżej 100 000, co oznacza, że osoby zarabiające takie sumy są wyjątkiem. Zarobki powyżej 150 000 również są rzadkością.

# Zależność pomiędzy liczbą dzieci a wiekiem
```{r}
ggplot(sklep_rowerowy, aes(x=children,
 y=age)) +
 geom_point() +
 xlab("Liczba dzieci") +
 ylab("Wiek")
ggtitle("Zależność pomiędzy wiekiem, a liczbą dzieci")

```
#Wniosek: Dane są rozporszone, co pokazuje, że dzieci znajdują się w każdej grupie wiekowej. Najczęstszą obserwacją, w ogólnym rozkładzie wieku jest liczba dzieci: 2 i 3. Osoby w wieku poniżej 40 lat w zdecydowaniej większości nie posiadają dzieci lub pojawiają się one około 30 roku życia. Wyjątek można zauwazyć w pojedynczych przypadkach, choć przy 3 dzieci można zauważyć mocną tendencje wzrostową. 

#Zależność pomiędzy posiadaniem domu a wiekiem

```{r}
ggplot(sklep_rowerowy, aes(x=age,
 y=home_owner)) +
 geom_boxplot() +
 xlab("Wiek") +
 ylab("Posiadanie domu")
ggtitle("Posiadanie domu w porównaniu do wieku")

```
#Wniosek: Osoby nie posiadające domu są w większości młodsze, ale widać też starsze osoby. Osoby posiadające dom są rozłożone bardziej równomiernie, ale dominują osoby w średnim i starszym wieku. Osoby starsze częściej są właścicielami domu co jest logiczne, ponieważ nieruchomość wymaga stabilizacji finansowej i czasu. Dodatkowo występuje kilka punktów odstających (outliers)????, które można zauważyć poza głównym obszarem wykresu - wśród posiadaczy domu są osoby powyżej 80 lat, ale pośród osoby bez domu również znadją się osoby w podeszłym wieku. Posiadanie domu rośnie z wiekiem, ponieważ ludzie oszczędzają przez lata i inwestują w nieruchomości. 

#Zależność zarobków od poziomu edukacji 
```{r}
ggplot(sklep_rowerowy, aes(x=income,
 y=education)) +
 geom_boxplot() +
 xlab("Zarobki") +
 ylab("Poziom edukacji")
ggtitle("Zależność zarobków od poziomu edukacji")

```
#Poziom wykształcenia i wyjaśnienie Partial High School- częściowe wykształcenie średnie; Partial College - częściowe wykształcenie wyższe; High School - wykształcenie średnie; Graduate Degree - stopień magisterski;  Bachelors - licencjat.
#Wniosek: 
tu koncze na razie - Edyta 


# rower vs pensja
```{r}
ggplot(sklep_rowerowy, aes(x=income,
 y=purchased_bike)) +
 geom_boxplot() +
 xlab("Zarobki") +
 ylab("Liczba rowerów")
ggtitle("Zależność zarobków do posiadania rowerów")

```
#dodane Julia

#Wykres gęstości zarobków- widac, ze nie jest to rozkład normalny- test Shapiro-wilka do normalnego rozkladu
#p-value spr
#zastanowic sie czy ponizsze jest potrzebne
#spr jaki test statystyczny tu zrobic- z jakiego rozkladu pochodza te dane i takim testem sprawdzone

```{r}
ggplot(sklep_rowerowy, aes(x = income)) +
  geom_density(alpha = 0.7, fill = "blue", color = "black") +
  xlab("Zarobek") +
  ylab("Gęstość") +
  ggtitle("Rozkład zarobków") +
  theme_minimal()
```


# Grupowanie i zliczanie
```{r}
library(dplyr)

dane_zliczone <- sklep_rowerowy %>%
  group_by(region, purchased_bike) %>%
  summarise(liczba = n())
```

#region vs liczba rowerów- takie wykresy porobic
```{r}
library(ggplot2)

ggplot(dane_zliczone, aes(x = region, y = liczba, fill = purchased_bike)) +
  geom_bar(stat = "identity", position = "dodge") +
  xlab("Region") +
  ylab("Liczba osób") +
  ggtitle("Liczba osób posiadających rowery w zależności od regionu") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red"), name = "Posiadanie roweru")
```


# Grupowanie według wieku i posiadania roweru, a następnie zliczanie
```{r}
library(dplyr)

dane_wiek <- sklep_rowerowy %>%
  group_by(age, purchased_bike) %>%
  summarise(liczba = n(), .groups = "drop")
```

#wiek vs liczba rowerów
```{r}
library(ggplot2)

ggplot(dane_wiek, aes(x = age, y = liczba, fill = purchased_bike)) +
  geom_bar(stat = "identity", position = "dodge") +
  xlab("Wiek") +
  ylab("Liczba osób") +
  ggtitle("Liczba osób posiadających rowery w zależności od wieku") +
  scale_fill_manual(values = c("Yes" = "green", "No" = "purple"), name = "Posiadanie roweru")
```


# Grupowanie i zliczanie według odległości dojazdu i posiadania roweru
```{r}
library(dplyr)

dane_dojazd <- sklep_rowerowy %>%
  group_by(commute_distance, purchased_bike) %>%
  summarise(liczba = n(), .groups = "drop")
```

# rower vs odległość dojazdu do pracy
```{r}
library(ggplot2)
library(forcats)

ggplot(dane_dojazd, aes(x = factor(commute_distance, levels = sort(unique(commute_distance))), 
                        y = liczba, fill = purchased_bike)) +
  geom_bar(stat = "identity", position = "stack") +
  xlab("Odległość dojazdu do pracy") +
  ylab("Liczba osób") +
  ggtitle("Liczba osób posiadających rowery w zależności od odległości dojazdu do pracy") +
  scale_fill_manual(values = c("Yes" = "yellow", "No" = "orange"), name = "Posiadanie roweru") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Obrót etykiet dla lepszej czytelności
```


#ilość osób zamęznych vs wiek
```{r}
library(ggplot2)
library(hrbrthemes)
library(plotly)
library(ISLR) # for Credit data
data("Credit")

# Podziel zmienną Age na 3 przedziały wiekowe:
Credit$AgeGroup <- cut(Credit$Age, breaks=c(20,40,60,100),
                       labels=c("20-40", "40-60", "60-100"))

ggplot(Credit, aes(x=AgeGroup, fill=Married)) + 
  geom_bar(position="stack") +
  labs(title="Liczba osób zamężnych w zależności od grupy wiekowej", x="Grupa wiekowa", y="Liczba osób") +
  theme_classic()
```


#wnioskowanie statystyczne- wyciągniecie wniosków na temat wszystkich posiadaczy rowerów
#pod kazdym wykresem wnioski dla wykresu i uogolnienie dla populacji- spr tez enauczanie
#mozna zmieniac czcionki jak w wordzie/ mozna popatrzec na dostepne funkcje
#spr markdown na enauczaniu jak sie chunki wordowe dodaje
#wykres w zaleznosci od ilosci dzieci
#zrobic te wykresy dla kazdej danej- czy ma rower czy nie, lepiej wiecej niz mniej- pododawac

#dodane Julia 31/1/2025

# Grupowanie i zliczanie
```{r}
library(dplyr)

dane_zliczone <- sklep_rowerowy %>%
  group_by(marital_status, purchased_bike) %>%
  summarise(liczba = n())
```

#rower vs stan cywilny
```{r}
library(ggplot2)

ggplot(dane_zliczone, aes(x = marital_status, y = liczba, fill = purchased_bike)) +
  geom_bar(stat = "identity", position = "dodge") +
  xlab("Stan cywilny") +
  ylab("Liczba osób") +
  ggtitle("Ilość osób posiadających rower w zależności od stanu cywilnego") +
  scale_fill_manual(values = c("Yes" = "pink", "No" = "white"), name = "Posiadanie roweru")
```


#rower vs płeć
```{r}
library(dplyr)
library(ggplot2)

# Przygotowanie danych do wykresu kołowego
df_pie <- sklep_rowerowy %>%
  group_by(gender, purchased_bike) %>%
  summarise(count = n()) %>%
  mutate(percentage = round(count / sum(count) * 100, 1))  # Zaokrąglamy do 1 miejsca

# Tworzenie wykresu kołowego z etykietami procentowymi
ggplot(df_pie, aes(x = "", y = percentage, fill = purchased_bike)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +  # Tworzymy wykres kołowy
  facet_wrap(~gender) +  # Oddzielne koła dla każdej płci
  geom_text(aes(label = paste0(percentage, "%")),  # Dodajemy procenty
            position = position_stack(vjust = 0.5), size = 5, color = "white") +  
  labs(title = "Procent osób posiadających rower w podziale na płeć", fill = "Posiadanie roweru") +
  scale_fill_manual(values = c("Yes" = "#2E86C1", "No" = "#A93226")) +
  theme_void()  # Usuwamy osie dla czystego wyglądu
```



#rower vs posiadanie dzieci
```{r}
library(ggplot2)
library(hrbrthemes)

ggplot(sklep_rowerowy, aes(x = factor(children), fill = purchased_bike)) +
  geom_bar(position = "dodge", width = 0.6) +
  labs(title = "Posiadanie roweru w zależności od liczby dzieci",
       x = "Liczba dzieci", y = "Liczba osób") +
  scale_fill_manual(values = c("Yes" = "#00BFC4", "No" = "#F8766D"), 
                    name = "Posiadanie roweru") +
  theme_minimal(base_size = 14)
```

#rower vs poziom wykształcenia
```{r}
library(dplyr)

# Przygotowanie danych do wykresu kołowego
df_pie <- sklep_rowerowy %>%
  group_by(education, purchased_bike) %>%
  summarise(count = n()) %>%
  mutate(percentage = round(count / sum(count) * 100, 1))  # Zaokrąglamy do 1 miejsca

# Tworzenie wykresu kołowego z etykietami procentowymi
ggplot(df_pie, aes(x = "", y = percentage, fill = purchased_bike)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +  # Tworzymy wykres kołowy
  facet_wrap(~education) +  # Osobne koła dla każdej grupy edukacyjnej
  geom_text(aes(label = paste0(percentage, "%")),  
            position = position_stack(vjust = 0.5), size = 5, color = "white") +  
  labs(title = "Procent osób posiadających rower w zależności od poziomu edukacji", 
       fill = "Czy posiada rower?") +
  scale_fill_manual(values = c("Yes" = "gray", "No" = "purple")) +
  theme_void() +
  theme(strip.text = element_text(size = 12, face = "bold"))  # Lepsza czytelność
```


#rower vs zawód
```{r}
library(ggplot2)
library(dplyr)
library(ggmosaic)  # Dla wykresu mozaikowego


ggplot(sklep_rowerowy, aes(x = occupation, fill = purchased_bike)) +
  geom_bar(position = "dodge") +
  scale_fill_manual(values = c("Yes" = "salmon", "No" = "white")) +  # Zmiana kolorów
  labs(title = "Ilość osób posiadających rower w zależności od zawodu", 
       x = "Zawód", 
       y = "Liczba osób", 
       fill = "Posiadanie roweru") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

#rower vs posiadanie domu
```{r}
library(ggplot2)
library(dplyr)

ggplot(sklep_rowerowy, aes(x = home_owner, fill = purchased_bike)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  scale_fill_manual(values = c("Yes" = "darkgreen", "No" = "lightblue")) +  # Zmiana kolorów
  labs(title = "Procent osób mających rower w zalezności od posiadania domu", 
       x = "Posiadanie domu", 
       y = "Procent", 
       fill = "Posiadanie roweru") +
  theme_minimal()
```
#rower vs posiadanie auta
```{r}
library(ggplot2)
library(hrbrthemes)

ggplot(sklep_rowerowy, aes(x = factor(cars), fill = purchased_bike)) +
  geom_bar(position = "dodge", width = 0.6) +
  labs(title = "Zależność między posiadaniem roweru, a ilością aut",
       x = "Liczba aut", y = "Liczba osób") +
  scale_fill_manual(values = c("Yes" = "#00BFC4", "No" = "#F8766D"), 
                    name = "Posiadanie roweru") +
  theme_minimal(base_size = 14)
```

